<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker - Personal Finance Manager</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide icons as SVG components
        const Wallet = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"></path>
                <path d="M4 6v12c0 1.1.9 2 2 2h14v-4"></path>
                <path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"></path>
            </svg>
        );

        const TrendingUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const TrendingDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                <polyline points="17 18 23 18 23 12"></polyline>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const DollarSign = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const MessageCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </svg>
        );

        const Send = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        // Mock storage API for GitHub Pages (uses localStorage)
        window.storage = {
            get: async (key) => {
                const value = localStorage.getItem(key);
                if (value === null) throw new Error('Key not found');
                return { key, value, shared: false };
            },
            set: async (key, value) => {
                localStorage.setItem(key, value);
                return { key, value, shared: false };
            },
            delete: async (key) => {
                localStorage.removeItem(key);
                return { key, deleted: true, shared: false };
            },
            list: async (prefix) => {
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (!prefix || key.startsWith(prefix)) {
                        keys.push(key);
                    }
                }
                return { keys, prefix, shared: false };
            }
        };

        function BudgetTracker() {
          const [income, setIncome] = useState(0);
          const [expenses, setExpenses] = useState([]);
          const [budgets, setBudgets] = useState([]);
          const [showAddExpense, setShowAddExpense] = useState(false);
          const [showAddBudget, setShowAddBudget] = useState(false);
          const [newExpense, setNewExpense] = useState({ name: '', amount: '', category: 'food' });
          const [newBudget, setNewBudget] = useState({ category: 'food', limit: '' });
          const [loading, setLoading] = useState(true);
          const [saveStatus, setSaveStatus] = useState('');
          const [showChat, setShowChat] = useState(false);
          const [messages, setMessages] = useState([]);
          const [inputMessage, setInputMessage] = useState('');
          const [isAiTyping, setIsAiTyping] = useState(false);
          const chatEndRef = useRef(null);

          const categories = [
            { id: 'food', name: 'Food & Dining', color: 'bg-orange-500' },
            { id: 'transport', name: 'Transportation', color: 'bg-blue-500' },
            { id: 'entertainment', name: 'Entertainment', color: 'bg-purple-500' },
            { id: 'shopping', name: 'Shopping', color: 'bg-pink-500' },
            { id: 'bills', name: 'Bills & Utilities', color: 'bg-red-500' },
            { id: 'health', name: 'Health', color: 'bg-green-500' },
            { id: 'other', name: 'Other', color: 'bg-gray-500' }
          ];

          useEffect(() => {
            loadData();
          }, []);

          useEffect(() => {
            if (!loading) {
              saveData();
            }
          }, [income, expenses, budgets]);

          useEffect(() => {
            chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);

          const loadData = async () => {
            try {
              const result = await window.storage.get('budget-data');
              if (result && result.value) {
                const data = JSON.parse(result.value);
                setIncome(data.income || 0);
                setExpenses(data.expenses || []);
                setBudgets(data.budgets || []);
              }
            } catch (error) {
              console.log('No saved data found, starting fresh');
            }
            setLoading(false);
          };

          const saveData = async () => {
            try {
              const data = { income, expenses, budgets };
              await window.storage.set('budget-data', JSON.stringify(data));
              setSaveStatus('✓ Saved');
              setTimeout(() => setSaveStatus(''), 2000);
            } catch (error) {
              console.error('Error saving data:', error);
              setSaveStatus('✗ Error saving');
              setTimeout(() => setSaveStatus(''), 2000);
            }
          };

          const exportData = () => {
            const data = { income, expenses, budgets };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `budget-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
          };

          const importData = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const data = JSON.parse(e.target.result);
                  setIncome(data.income || 0);
                  setExpenses(data.expenses || []);
                  setBudgets(data.budgets || []);
                  setSaveStatus('✓ Imported successfully');
                  setTimeout(() => setSaveStatus(''), 2000);
                } catch (error) {
                  alert('Error importing file. Please make sure it\'s a valid backup file.');
                }
              };
              reader.readAsText(file);
            }
          };

          const clearAllData = async () => {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
              setIncome(0);
              setExpenses([]);
              setBudgets([]);
              try {
                await window.storage.delete('budget-data');
              } catch (error) {
                console.error('Error clearing data:', error);
              }
            }
          };

          const totalExpenses = expenses.reduce((sum, exp) => sum + parseFloat(exp.amount), 0);
          const remaining = income - totalExpenses;
          const savingsRate = income > 0 ? ((remaining / income) * 100).toFixed(1) : 0;

          const categoryTotals = expenses.reduce((acc, exp) => {
            acc[exp.category] = (acc[exp.category] || 0) + parseFloat(exp.amount);
            return acc;
          }, {});

          const addExpense = () => {
            if (newExpense.name && newExpense.amount) {
              setExpenses([...expenses, { ...newExpense, id: Date.now(), date: new Date().toLocaleDateString() }]);
              setNewExpense({ name: '', amount: '', category: 'food' });
              setShowAddExpense(false);
            }
          };

          const addBudgetLimit = () => {
            if (newBudget.limit) {
              const existing = budgets.find(b => b.category === newBudget.category);
              if (existing) {
                setBudgets(budgets.map(b => 
                  b.category === newBudget.category ? { ...b, limit: parseFloat(newBudget.limit) } : b
                ));
              } else {
                setBudgets([...budgets, { ...newBudget, limit: parseFloat(newBudget.limit) }]);
              }
              setNewBudget({ category: 'food', limit: '' });
              setShowAddBudget(false);
            }
          };

          const deleteExpense = (id) => {
            setExpenses(expenses.filter(exp => exp.id !== id));
          };

          const getBudgetStatus = (category) => {
            const budget = budgets.find(b => b.category === category);
            const spent = categoryTotals[category] || 0;
            if (!budget) return null;
            const percentage = (spent / budget.limit) * 100;
            return { spent, limit: budget.limit, percentage };
          };

          const generateFinancialContext = () => {
            const categoryBreakdown = categories.map(cat => ({
              category: cat.name,
              spent: categoryTotals[cat.id] || 0,
              budget: budgets.find(b => b.category === cat.id)?.limit || 0
            })).filter(c => c.spent > 0 || c.budget > 0);

            return `Current Financial Situation:
- Monthly Income: $${income.toFixed(2)}
- Total Expenses: $${totalExpenses.toFixed(2)}
- Remaining: $${remaining.toFixed(2)}
- Savings Rate: ${savingsRate}%

Category Breakdown:
${categoryBreakdown.map(c => `- ${c.category}: $${c.spent.toFixed(2)}${c.budget > 0 ? ` / $${c.budget.toFixed(2)} budget` : ''}`).join('\n')}

Recent Expenses:
${expenses.slice(-5).reverse().map(e => `- ${e.name}: $${e.amount} (${categories.find(c => c.id === e.category)?.name})`).join('\n')}`;
          };

          const generateRuleBasedAdvice = (question) => {
            const lowerQ = question.toLowerCase();
            
            if (lowerQ.includes('save') || lowerQ.includes('saving')) {
              if (savingsRate < 10) {
                return `Your current savings rate is ${savingsRate}%. Financial experts recommend saving at least 20% of your income. Here are some tips:\n\n• Look at your ${Object.entries(categoryTotals).sort((a,b) => b[1] - a[1])[0]?.[0] || 'highest'} spending - can you reduce it by 10-15%?\n• Set up automatic transfers to savings on payday\n• Try the 50/30/20 rule: 50% needs, 30% wants, 20% savings`;
              } else if (savingsRate >= 20) {
                return `Great job! You're saving ${savingsRate}% of your income. To optimize further:\n\n• Consider investing some savings for long-term growth\n• Build an emergency fund (3-6 months expenses)\n• Look into retirement accounts if you haven't already`;
              } else {
                return `You're saving ${savingsRate}%, which is a good start! To reach the ideal 20%:\n\n• Identify one discretionary expense to reduce\n• Consider the "pay yourself first" approach\n• Track daily spending to find hidden costs`;
              }
            }
            
            if (lowerQ.includes('spend') || lowerQ.includes('budget')) {
              const overBudget = categories.filter(cat => {
                const status = getBudgetStatus(cat.id);
                return status && status.percentage > 100;
              });
              
              if (overBudget.length > 0) {
                return `You're over budget in: ${overBudget.map(c => c.name).join(', ')}. Here's what to do:\n\n• Review recent expenses in these categories\n• Set realistic budget limits based on past spending\n• Use the 24-hour rule before making non-essential purchases\n• Consider alternatives (cooking vs dining out, free entertainment)`;
              }
              
              const highestSpending = Object.entries(categoryTotals).sort((a,b) => b[1] - a[1])[0];
              if (highestSpending) {
                const catName = categories.find(c => c.id === highestSpending[0])?.name;
                return `Your highest spending is in ${catName} at $${highestSpending[1].toFixed(2)}. Consider:\n\n• Setting a specific budget for this category\n• Tracking individual purchases more carefully\n• Finding lower-cost alternatives\n• Using apps/tools specific to reducing these costs`;
              }
            }
            
            if (lowerQ.includes('debt') || lowerQ.includes('loan')) {
              return `For managing debt effectively:\n\n• List all debts with interest rates\n• Use the avalanche method (pay highest interest first) or snowball method (pay smallest first)\n• Allocate at least 15-20% of income to debt repayment\n• Avoid new debt while paying off existing\n• Consider balance transfers for high-interest credit cards`;
            }
            
            if (lowerQ.includes('emergency') || lowerQ.includes('fund')) {
              const emergencyFund = remaining > 0 ? (remaining * 3).toFixed(2) : (income * 3).toFixed(2);
              return `An emergency fund should cover 3-6 months of expenses. Based on your data:\n\n• Target: $${emergencyFund} (3 months)\n• Keep it in a high-yield savings account\n• Build it gradually, even $50/month helps\n• Use only for true emergencies\n• Once built, shift extra savings to investments`;
            }
            
            return `Based on your budget:\n\n• Income: $${income.toFixed(2)}\n• Expenses: $${totalExpenses.toFixed(2)}\n• Savings Rate: ${savingsRate}%\n\nGeneral tips:\n• Aim for 20% savings rate\n• Review spending weekly\n• Set realistic budget limits\n• Build a 3-6 month emergency fund\n• Track small purchases - they add up!\n\nWhat specific area would you like advice on? (savings, spending, debt, budgeting)`;
          };

          const sendMessage = async () => {
            if (!inputMessage.trim()) return;

            const userMessage = inputMessage.trim();
            setInputMessage('');
            
            setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
            setIsAiTyping(true);

            setTimeout(() => {
              const advice = generateRuleBasedAdvice(userMessage);
              setMessages(prev => [...prev, { role: 'assistant', content: advice }]);
              setIsAiTyping(false);
            }, 800);
          };

          if (loading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white flex items-center justify-center">
                <div className="text-2xl">Loading your budget...</div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white p-4 md:p-8">
              <div className="max-w-7xl mx-auto">
                <div className="mb-8 text-center relative">
                  <h1 className="text-5xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                    Budget Tracker
                  </h1>
                  <p className="text-gray-400">Take control of your finances</p>
                  {saveStatus && (
                    <div className="absolute top-0 right-0 text-sm text-green-400 bg-green-500/20 px-3 py-1 rounded-lg">
                      {saveStatus}
                    </div>
                  )}
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-4 mb-6 border border-white/20 flex flex-wrap gap-3 items-center justify-between">
                  <div className="flex gap-3 flex-wrap">
                    <button
                      onClick={exportData}
                      className="bg-blue-600 hover:bg-blue-700 rounded-lg px-4 py-2 flex items-center gap-2 transition-colors text-sm"
                    >
                      <Download size={18} />
                      Export Data
                    </button>
                    <label className="bg-green-600 hover:bg-green-700 rounded-lg px-4 py-2 flex items-center gap-2 transition-colors cursor-pointer text-sm">
                      <Upload size={18} />
                      Import Data
                      <input type="file" accept=".json" onChange={importData} className="hidden" />
                    </label>
                    <button
                      onClick={() => setShowChat(!showChat)}
                      className="bg-purple-600 hover:bg-purple-700 rounded-lg px-4 py-2 flex items-center gap-2 transition-colors text-sm"
                    >
                      <MessageCircle size={18} />
                      AI Advisor
                    </button>
                  </div>
                  <button
                    onClick={clearAllData}
                    className="bg-red-600 hover:bg-red-700 rounded-lg px-4 py-2 transition-colors text-sm"
                  >
                    Clear All Data
                  </button>
                </div>

                <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20">
                  <label className="block text-sm font-medium mb-2 text-gray-300">Monthly Income</label>
                  <div className="relative">
                    <DollarSign className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
                    <input
                      type="number"
                      value={income || ''}
                      onChange={(e) => setIncome(parseFloat(e.target.value) || 0)}
                      className="w-full bg-white/5 border border-white/20 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="Enter your monthly income"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                  <div className="bg-gradient-to-br from-green-500/20 to-green-600/20 backdrop-blur-lg rounded-2xl p-6 border border-green-500/30">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-gray-300">Total Income</span>
                      <Wallet className="text-green-400" size={24} />
                    </div>
                    <div className="text-3xl font-bold">${income.toFixed(2)}</div>
                  </div>

                  <div className="bg-gradient-to-br from-red-500/20 to-red-600/20 backdrop-blur-lg rounded-2xl p-6 border border-red-500/30">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-gray-300">Total Expenses</span>
                      <TrendingDown className="text-red-400" size={24} />
                    </div>
                    <div className="text-3xl font-bold">${totalExpenses.toFixed(2)}</div>
                  </div>

                  <div className={`bg-gradient-to-br ${remaining >= 0 ? 'from-blue-500/20 to-blue-600/20 border-blue-500/30' : 'from-red-500/20 to-red-600/20 border-red-500/30'} backdrop-blur-lg rounded-2xl p-6 border`}>
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-gray-300">Remaining</span>
                      <TrendingUp className={remaining >= 0 ? 'text-blue-400' : 'text-red-400'} size={24} />
                    </div>
                    <div className="text-3xl font-bold">${remaining.toFixed(2)}</div>
                    <div className="text-sm text-gray-400 mt-1">{savingsRate}% savings rate</div>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold">Expenses</h2>
                      <button
                        onClick={() => setShowAddExpense(!showAddExpense)}
                        className="bg-purple-600 hover:bg-purple-700 rounded-lg px-4 py-2 flex items-center gap-2 transition-colors"
                      >
                        <Plus size={20} />
                        Add
                      </button>
                    </div>

                    {showAddExpense && (
                      <div className="bg-white/5 rounded-lg p-4 mb-4 border border-white/10">
                        <input
                          type="text"
                          value={newExpense.name}
                          onChange={(e) => setNewExpense({ ...newExpense, name: e.target.value })}
                          placeholder="Expense name"
                          className="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-2 mb-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        />
                        <input
                          type="number"
                          value={newExpense.amount}
                          onChange={(e) => setNewExpense({ ...newExpense, amount: e.target.value })}
                          placeholder="Amount"
                          className="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-2 mb-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        />
                        <select
                          value={newExpense.category}
                          onChange={(e) => setNewExpense({ ...newExpense, category: e.target.value })}
                          className="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-2 mb-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                          style={{backgroundColor: 'rgba(255,255,255,0.05)'}}
                        >
                          {categories.map(cat => (
                            <option key={cat.id} value={cat.id} style={{backgroundColor: '#1e293b'}}>{cat.name}</option>
                          ))}
                        </select>
                        <button
                          onClick={addExpense}
                          className="w-full bg-purple-600 hover:bg-purple-700 rounded-lg py-2 transition-colors"
                        >
                          Add Expense
                        </button>
                      </div>
                    )}

                    <div className="space-y-3 max-h-96 overflow-y-auto">
                      {expenses.length === 0 ? (
                        <p className="text-gray-400 text-center py-8">No expenses yet</p>
                      ) : (
                        expenses.map(exp => {
                          const cat = categories.
